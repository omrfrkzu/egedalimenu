// Menu Data - Embedded directly in JavaScript (no backend needed)
const MENU_DATA = {
  "version": 1,
  "updatedAt": "2025-12-19T00:00:00Z",
  "items": [
    {
      "id": 1,
      "name": "PESTO - FÜME",
      "category": "favoriler",
      "description": "Yumuşak beyaz peynir, yeşil pesto sos, antrikot füme",
      "price": 215.00,
      "image": "Sandviçler/et-fume-pesto-sandviç.jpg"
    },
    {
      "id": 2,
      "name": "EGE SERPMESİ",
      "category": "favoriler",
      "description": "Ege bölgesine özgü zeytin, peynir, domates ve taze otlarla hazırlanmış serpme tabak",
      "price": 209.00,
      "image": "Kahvaltı Tabakları/ege-sabahı.jpg"
    },
    {
      "id": 110,
      "name": "Balkan Sandviç",
      "category": "favoriler",
      "description": "Taze süt kaşar peyniri, balkan salam, boşnak kuru et, amerikan salatası, çeri domates, roka",
      "price": 425.00,
      "image": "Sandviçler/balkan-sandviç.jpg"
    },
    {
      "id": 63,
      "name": "Güne Merhaba",
      "category": "favoriler",
      "description": "İspanyol salam, taze süt kaşarı, zeytin, tereyağı, bal, reçel, haşlanmış yumurta, zeytinyağı, domates, salatalık, roka",
      "price": 390.00,
      "image": "Kahvaltı Tabakları/güne-merhaba.jpg"
    },
    {
      "id": 304,
      "name": "Serpme Kahvaltı",
      "category": "favoriler",
      "description": "Beyaz Peynir, Kaşar Ve Tulum Peyniri, Salam, Dana Füme, Kekikli Sucuk, Siyah Ve Yeşil Zeytin, Sahanda Yumurta Veya Menemen, Simit, Tam Buğday Ekmeği, Bal, Kaymak Ve Reçel Çeşitleri, Domates, Salatalık, Yeşillikler, Paçanga Ve Ispanaklı Sigara Böreği, Sınırsız Çay",
      "price": 2200.00,
      "image": "Sıcak Lezzetler/serpme-kahvaltı.jpg"
    },
    {
      "id": 59,
      "name": "Yöresel Kahvaltı",
      "category": "kahvalti",
      "description": "Yaban mersinli tulum, trakya eski kaşar, dil peyniri, taze süt kaşarı, haşlanmış yumurta, balkan salam, pastırma, hindi füme",
      "price": 625.00,
      "image": "Kahvaltı Tabakları/yoresel-kahvaltı.jpg"
    },
    {
      "id": 60,
      "name": "Gurme Kahvaltı",
      "category": "kahvalti",
      "description": "Dil peyniri, taze süt kaşarı, beyaz peynir, tereyağ, haşlanmış yumurta, pastırma, balkan salamı, hindi füme, dana kavurma, special tulum peyniri, acıbiber reçeli, mix zeytin",
      "price": 580.00,
      "image": "Kahvaltı Tabakları/gurme-kahvaltı.jpg"
    },
    {
      "id": 61,
      "name": "Anadolu Esintisi",
      "category": "kahvalti",
      "description": "Humus, beyaz peynir, yayık tereyağı, çilek reçeli, domates, salatalık, mix zeytin",
      "price": 350.00,
      "image": "Kahvaltı Tabakları/anadolu-esintisi.jpg"
    },
    {
      "id": 62,
      "name": "Ege Sabahı",
      "category": "kahvalti",
      "description": "Lor, zeytinyağ, reçel, mix zeytin, acuka, simit, bal kaymak, beyaz peynir, domates, salatalık",
      "price": 445.00,
      "image": "Kahvaltı Tabakları/ege-sabahı.jpg"
    },
    {
      "id": 64,
      "name": "Sabah Sofrası",
      "category": "kahvalti",
      "description": "Dil peyniri, lor peyniri, beyaz peynir, dana kavurma, tereyağı, bal, acı biber reçeli, acuka, ajvar, mix zeytin, domates, salatalık",
      "price": 490.00,
      "image": "Kahvaltı Tabakları/sabah-sofrası.jpg"
    },
    {
      "id": 65,
      "name": "Peynir & Füme Keyfi",
      "category": "kahvalti",
      "description": "Eski kaşar, taze süt kaşarı, beyaz peynir, isli peynir, ispanyol salam, kekikli sucuk, hindi füme, pastırma",
      "price": 790.00,
      "image": "Kahvaltı Tabakları/peynir ve fume keyfi.jpg"
    },
    {
      "id": 66,
      "name": "Güne Merhaba",
      "category": "kahvalti",
      "description": "İspanyol salam, taze süt kaşarı, zeytin, tereyağı, bal, reçel, haşlanmış yumurta, zeytinyağı, domates, salatalık, roka",
      "price": 390.00,
      "image": "Kahvaltı Tabakları/güne-merhaba.jpg"
    },
    {
      "id": 309,
      "name": "Altınoluk Kahvaltısı",
      "category": "kahvalti",
      "description": "Kızarmış Mihaliç Peyniri, Kırma Zeytin, Beyaz Peynir, Kızarmış Kasap Sucuk, Domates, Yeşillik, Sıcak Süt İle Servis Edilir",
      "price": 475.00,
      "image": "Kahvaltı Tabakları/güne-merhaba.jpg"
    },
    {
      "id": 310,
      "name": "Protein Tabağı",
      "category": "kahvalti",
      "description": "Kahvaltılık Kaşar Loru, Taze Süt Kaşarı, Beyaz Peynir, Pastırma, Antrikot Füme, Pembe Domates, Yeşillik, Sıcak Süt İle Servis Edilir",
      "price": 580.00,
      "image": "Kahvaltı Tabakları/peynir ve fume keyfi.jpg"
    },
    {
      "id": 311,
      "name": "Şarküteri Seçkisi",
      "category": "kahvalti",
      "description": "Karabiberli Balkan Salamı, Dana Cotto, Pastırma, Kekikli Sucuk, İtalyan Salamı, Kavurma",
      "price": 580.00,
      "image": "Kahvaltı Tabakları/yoresel-kahvaltı.jpg"
    },
    {
      "id": 312,
      "name": "Fine Breakfast Plate",
      "category": "kahvalti",
      "description": "Manchego Peyniri, Beyaz Peynir, Eski Kaşar, Füme Dil, Kavurma, Bal Kaymak, Mix Zeytin, Reçel",
      "price": 650.00,
      "image": "Kahvaltı Tabakları/gurme-kahvaltı.jpg"
    },
    {
      "id": 70,
      "name": "Sade Menemen",
      "category": "yumurta",
      "description": "Domates, biber ve yumurta ile hazırlanmış geleneksel menemen",
      "price": 250.00,
      "image": "Yumurta çeşitleri/sade-menemen.jpg"
    },
    {
      "id": 72,
      "name": "Beyaz Peynirli Menemen",
      "category": "yumurta",
      "description": "Beyaz peynir ile hazırlanmış özel menemen",
      "price": 275.00,
      "image": "Yumurta çeşitleri/beyaz-peynirli-menemen.jpg"
    },
    {
      "id": 71,
      "name": "Kaşarlı Menemen",
      "category": "yumurta",
      "description": "Kaşar peyniri ile zenginleştirilmiş nefis menemen",
      "price": 275.00,
      "image": "Yumurta çeşitleri/kaşarlı-menemen.jpg"
    },
    {
      "id": 201,
      "name": "Kavurmalı Menemen",
      "category": "yumurta",
      "description": "Dana kavurma ile hazırlanmış nefis menemen",
      "price": 350.00,
      "image": "Yumurta çeşitleri/kavurmalı-menemen.jpg"
    },
    {
      "id": 202,
      "name": "Sucuklu Menemen",
      "category": "yumurta",
      "description": "Taze sucuk ile hazırlanmış nefis menemen",
      "price": 350.00,
      "image": "Yumurta çeşitleri/sucuklu-menemen.jpg"
    },
    {
      "id": 203,
      "name": "Sade Omlet",
      "category": "yumurta",
      "description": "Klasik sade omlet",
      "price": 220.00,
      "image": "Yumurta çeşitleri/sade-omlet.jpg"
    },
    {
      "id": 69,
      "name": "Kaşarlı Omlet",
      "category": "yumurta",
      "description": "Kaşar peyniri ile hazırlanmış klasik omlet",
      "price": 275.00,
      "image": "Yumurta çeşitleri/kaşarlı-omlet.jpg"
    },
    {
      "id": 204,
      "name": "Beyaz Peynirli Omlet",
      "category": "yumurta",
      "description": "Beyaz peynir ile hazırlanmış özel omlet",
      "price": 275.00,
      "image": "Yumurta çeşitleri/beyaz-peynirli-omlet.jpg"
    },
    {
      "id": 200,
      "name": "Sebzeli Omlet",
      "category": "yumurta",
      "description": "Taze sebzeler ve baharatlarla hazırlanmış nefis sebzeli omlet",
      "price": 260.00,
      "image": "Yumurta çeşitleri/sebzeli-omlet.jpg"
    },
    {
      "id": 205,
      "name": "Sucuklu Omlet",
      "category": "yumurta",
      "description": "Taze sucuk ile hazırlanmış nefis omlet",
      "price": 280.00,
      "image": "Yumurta çeşitleri/sucuklu-omlet.jpg"
    },
    {
      "id": 206,
      "name": "Kavurmalı Omlet",
      "category": "yumurta",
      "description": "Dana kavurma ile hazırlanmış nefis omlet",
      "price": 280.00,
      "image": "Yumurta çeşitleri/kavurmalı-omlet.jpg"
    },
    {
      "id": 68,
      "name": "İtalyan Pastırmalı Omlet",
      "category": "yumurta",
      "description": "İtalyan pastırması ve özel baharatlarla hazırlanmış nefis omlet",
      "price": 435.00,
      "image": "Yumurta çeşitleri/pastırmalı-omlet.jpg"
    },
    {
      "id": 207,
      "name": "Sade Yumurta",
      "category": "yumurta",
      "description": "Klasik sade yumurta",
      "price": 220.00,
      "image": "Yumurta çeşitleri/sade-yumurta.jpg"
    },
    {
      "id": 208,
      "name": "Sucuklu Yumurta",
      "category": "yumurta",
      "description": "Taze sucuk ile hazırlanmış nefis yumurta",
      "price": 280.00,
      "image": "Yumurta çeşitleri/sucuklu-yumurta.jpg"
    },
    {
      "id": 209,
      "name": "Beyaz Peynirli Yumurta",
      "category": "yumurta",
      "description": "Beyaz peynir ile hazırlanmış özel yumurta",
      "price": 275.00,
      "image": "Yumurta çeşitleri/beyaz-peynirli-yumurta.jpg"
    },
    {
      "id": 210,
      "name": "Kavurmalı Yumurta",
      "category": "yumurta",
      "description": "Dana kavurma ile hazırlanmış nefis yumurta",
      "price": 280.00,
      "image": "Yumurta çeşitleri/kavurmalı-yumurta.jpg"
    },
    {
      "id": 211,
      "name": "Kaşarlı Yumurta",
      "category": "yumurta",
      "description": "Kaşar peyniri ile hazırlanmış nefis yumurta",
      "price": 250.00,
      "image": "Yumurta çeşitleri/kaşarlı-yumurta.jpg"
    },
    {
      "id": 212,
      "name": "Sebzeli Yumurta",
      "category": "yumurta",
      "description": "Taze sebzeler ve baharatlarla hazırlanmış nefis sebzeli yumurta",
      "price": 260.00,
      "image": "Yumurta çeşitleri/sebzeli-yumurta.jpg"
    },
    {
      "id": 73,
      "name": "Pastırmalı Yumurta",
      "category": "yumurta",
      "description": "Taze pastırma ile hazırlanmış nefis yumurta",
      "price": 280.00,
      "image": "Yumurta çeşitleri/pastırmalı-yumurta.jpg"
    },
    {
      "id": 102,
      "name": "Baget Sandviç",
      "category": "sandvicler",
      "description": "Çıtır baget ekmek, yeşil pesto sos, şirden mayalı beyaz peynir, ispanyol geniş salam, pembe domates, roka",
      "price": 275.00,
      "image": "Sandviçler/baget-ssandviç.jpg"
    },
    {
      "id": 103,
      "name": "Tatlı Sandviç",
      "category": "sandvicler",
      "description": "Manda kaymağı, çikolata, reçel veya bal",
      "price": 325.00,
      "image": "Sandviçler/tatlı-sandviç.jpg"
    },
    {
      "id": 104,
      "name": "Mezeli Gurme Sandviç",
      "category": "sandvicler",
      "description": "Patlıcan salatası, közlenmiş biber, haydari, beyaz peynir, kavrulmuş ceviz parçaları",
      "price": 335.00,
      "image": "Sandviçler/mezeli-gurme-sandviç.jpg"
    },
    {
      "id": 105,
      "name": "Amerikan Salatalı Ciğer Sandviç",
      "category": "sandvicler",
      "description": "Ciabatta ekmeği, arnavut ciğeri ve amerikan salatası",
      "price": 380.00,
      "image": "Sandviçler/amerikan-ciğer-sandviç.jpg"
    },
    {
      "id": 106,
      "name": "Egedalı Sandviç",
      "category": "sandvicler",
      "description": "Eski kaşar peyniri, antrikot dana füme, ispanyol mezesi, zeytinyağlı kuru domates ve roka",
      "price": 380.00,
      "image": "Sandviçler/egedalı-sandviç.jpg"
    },
    {
      "id": 107,
      "name": "Kafkas Sandviç",
      "category": "sandvicler",
      "description": "İsli çerkez peyniri, boşnak kuru et, abaza peyniri, acuka, çeri domates, roka",
      "price": 390.00,
      "image": "Sandviçler/kafkas-sandviç.jpg"
    },
    {
      "id": 108,
      "name": "Mortadella Sandviç",
      "category": "sandvicler",
      "description": "Mortadella salamı, ispanyol mezesi, trakya eski kaşar, turşu, zeytinyağlı kuru domates",
      "price": 390.00,
      "image": "Sandviçler/mortadella-sandviç.jpg"
    },
    {
      "id": 109,
      "name": "Bergama Sofrası",
      "category": "sandvicler",
      "description": "Bergama tulumu, pastırma, domates, girit ezmesi, ispanyol mezesi, roka",
      "price": 410.00,
      "image": "Sandviçler/bergama-sofrası-sandviç.jpg"
    },
    {
      "id": 111,
      "name": "Et Füme & Pesto Sandviç",
      "category": "sandvicler",
      "description": "İnce dilim füme et, beyaz peynir, yeşil pesto sos, roka",
      "price": 425.00,
      "image": "Sandviçler/et-fume-pesto-sandviç.jpg"
    },
    {
      "id": 112,
      "name": "Kekikli Sandviç",
      "category": "sandvicler",
      "description": "Kekikli sucuk, abaza peyniri, amerikan salatası, çeri domates, roka",
      "price": 425.00,
      "image": "Sandviçler/kekikli-sandviç.jpg"
    },
    {
      "id": 113,
      "name": "Mozarella Sandviç",
      "category": "sandvicler",
      "description": "Boşnak kuru et, buffa manda mozarella, roka çeri domates, pesto sos",
      "price": 450.00,
      "image": "Sandviçler/mozzarella-sandviç.jpg"
    },
    {
      "id": 114,
      "name": "İtalyan Sandviç",
      "category": "sandvicler",
      "description": "İtalyan salam, sepet peyniri, italyan mezesi, kavurma, zeytinyağlı kuru domates, roka",
      "price": 465.00,
      "image": "Sandviçler/italyan-sandviç.jpg"
    },
    {
      "id": 115,
      "name": "Karides & Pesto Sandviç",
      "category": "sandvicler",
      "description": "Karides, roka, yeşil pesto sos, ince dilimlenmiş domates, tulum peyniri rendesi, üzeri nar ekşisi",
      "price": 475.00,
      "image": "Sandviçler/karides-pesto-sandviç.jpg"
    },
    {
      "id": 305,
      "name": "Girit Ezmeli",
      "category": "sandvicler",
      "description": "Girit Ezmesi, Antrikot Pastırma, Pembe Domates, Roka",
      "price": 375.00,
      "image": "Sandviçler/bergama-sofrası-sandviç.jpg"
    },
    {
      "id": 306,
      "name": "Izgara Mihaliç Peynirli",
      "category": "sandvicler",
      "description": "Izgarada Kızarmış Savaş Tepenin Mihaliç Peyniri, Düzce Ev Acukası, Kasap Sucuk ve Yeşillikler İle Servis Edilir. Bu Sandviç Sadece Masaya Servisler İçindir.",
      "price": 425.00,
      "image": "Sandviçler/egedalı-sandviç.jpg"
    },
    {
      "id": 307,
      "name": "Cevizli Kaşarlı",
      "category": "sandvicler",
      "description": "Cevizli Kaşkaval Peyniri, Dana Roasbeef, Yeşil Elmalı Pancar Salatası ve Yeşillik",
      "price": 450.00,
      "image": "Sandviçler/mozzarella-sandviç.jpg"
    },
    {
      "id": 308,
      "name": "Sıcak Kavurma Sandviç",
      "category": "sandvicler",
      "description": "Tereyağında Kavrulmuş Kavurma, Taze Süt Kaşarı, Çeri Domates, Yeşillik",
      "price": 475.00,
      "image": "Sandviçler/karides-pesto-sandviç.jpg"
    },
    {
      "id": 216,
      "name": "Izgara Hellim Salatası",
      "category": "sicaklar",
      "description": "Izgara hellim peyniri, taze sebzeler ve özel soslarla hazırlanmış salata",
      "price": 380.00,
      "image": "Sıcak Lezzetler/ızgara-hellim-salatası.jpg"
    },
    {
      "id": 80,
      "name": "Kıymalı Fırınlanmış Mantı",
      "category": "sicaklar",
      "description": "Kıymalı iç harçla hazırlanmış, fırında pişirilmiş özel mantı",
      "price": 490.00,
      "image": "Sıcak Lezzetler/kıymalı-mantı.png"
    },
    {
      "id": 81,
      "name": "Ekmek Üzeri Çemensiz Pastırmalı Yumurta",
      "category": "sicaklar",
      "description": "Taze ekmek üzerine çemensiz pastırma ve yumurta ile hazırlanmış sıcak lezzet",
      "price": 475.00,
      "image": "Sıcak Lezzetler/ekmek-üzeri-pastırmalı-yumurta.jpg"
    },
    {
      "id": 218,
      "name": "Patates Kızartması (Büyük)",
      "category": "sicaklar",
      "description": "Taze patateslerden hazırlanmış çıtır kızartma - büyük porsiyon",
      "price": 185.00,
      "image": "Sıcak Lezzetler/patates-kızartması.jpg"
    },
    {
      "id": 219,
      "name": "Pet Şişe Su (400 ml)",
      "category": "icecekler",
      "description": "Doğal kaynak suyu",
      "price": 25.00,
      "image": "İçecekler/uludağ-pet-su.jpg"
    },
    {
      "id": 220,
      "name": "Su (330 ml)",
      "category": "icecekler",
      "description": "Doğal kaynak suyu",
      "price": 35.00,
      "image": "İçecekler/uludağ-cam-su.jpg"
    },
    {
      "id": 221,
      "name": "Beypazarı Soda (200 ml)",
      "category": "icecekler",
      "description": "Doğal maden sodası",
      "price": 30.00,
      "image": "İçecekler/beypazarı-soda.jpg"
    },
    {
      "id": 222,
      "name": "Şevketpaşa Ayran (245 ml)",
      "category": "icecekler",
      "description": "Geleneksel Türk ayranı",
      "price": 95.00,
      "image": "İçecekler/şevketpaşa-ayran.jpg"
    },
    {
      "id": 224,
      "name": "Organik Vişne Suyu (250 ml)",
      "category": "icecekler",
      "description": "Doğal organik vişne suyu",
      "price": 90.00,
      "image": "İçecekler/vişne-suyu.jpg"
    },
    {
      "id": 225,
      "name": "Organik Portakal Suyu (250 ml)",
      "category": "icecekler",
      "description": "Taze sıkılmış organik portakal suyu",
      "price": 90.00,
      "image": "İçecekler/portakal-suyu.jpg"
    },
    {
      "id": 226,
      "name": "Organik Elma Suyu (250 ml)",
      "category": "icecekler",
      "description": "Doğal organik elma suyu",
      "price": 90.00,
      "image": "İçecekler/elma-suyu.jpg"
    },
    {
      "id": 227,
      "name": "Organik Elma-Şeftali Suyu (250 ml)",
      "category": "icecekler",
      "description": "Doğal organik elma-şeftali karışımı",
      "price": 90.00,
      "image": "İçecekler/elma-şeftali-suyu.jpg"
    },
    {
      "id": 213,
      "name": "Organik Nar Suyu (250 ml)",
      "category": "icecekler",
      "description": "Doğal organik nar suyu",
      "price": 90.00,
      "image": "İçecekler/nar-suyu.jpg"
    },
    {
      "id": 86,
      "name": "Americano (Orta Boy)",
      "category": "icecekler",
      "description": "Espresso ve sıcak su ile hazırlanmış Americano",
      "price": 110.00,
      "image": "İçecekler/americano.jpg"
    },
    {
      "id": 87,
      "name": "Espresso",
      "category": "icecekler",
      "description": "Yoğun ve aromatik espresso",
      "price": 110.00,
      "image": "İçecekler/espresso.jpg"
    },
    {
      "id": 88,
      "name": "Cafe Latte (Orta Boy)",
      "category": "icecekler",
      "description": "Espresso ve buharda ısıtılmış süt ile hazırlanmış latte",
      "price": 110.00,
      "image": "İçecekler/cafe-latte.jpg"
    },
    {
      "id": 214,
      "name": "Cortado (Orta Boy)",
      "category": "icecekler",
      "description": "Espresso ve az miktarda buharda ısıtılmış süt ile hazırlanmış cortado",
      "price": 110.00,
      "image": "İçecekler/cortado.jpg"
    },
    {
      "id": 89,
      "name": "Cappucino (Orta Boy)",
      "category": "icecekler",
      "description": "Espresso, buharda ısıtılmış süt ve süt köpüğü ile hazırlanmış cappucino",
      "price": 110.00,
      "image": "İçecekler/cappucino.jpg"
    },
    {
      "id": 215,
      "name": "Beyoğlu Gazoz (250 ml)",
      "category": "icecekler",
      "description": "Geleneksel Türk gazozu",
      "price": 60.00,
      "image": "İçecekler/beyoğlu-gazoz.jpg"
    }
  ],
  "categories": {
    "favoriler": "Favoriler",
    "kahvalti": "Kahvaltı Tabakları",
    "yumurta": "Yumurta Çeşitleri",
    "sandvicler": "Sandviçler",
    "sicaklar": "Sıcak Lezzetler",
    "icecekler": "İçecekler"
  }
};



let menuItems = [];

// Load menu data directly from embedded data (no backend needed)
function loadMenuData() {
    // Use embedded menu data
    const data = MENU_DATA;
    
    // Check if data has items
    if (!data || !data.items || !Array.isArray(data.items)) {
        console.error('Invalid menu data format:', data);
        throw new Error('Menü verisi geçersiz format');
    }
    
    menuItems = data.items || [];
    
    console.log('Menu loaded:', {
        totalItems: menuItems.length,
        categories: Object.keys(data.categories || {}),
        sampleItems: menuItems.slice(0, 3).map(i => ({ id: i.id, name: i.name, category: i.category }))
    });
    
    // Update category names
    if (data.categories) {
        categoryNames = data.categories;
    }
    
    // Sort menu items by price (ascending)
    menuItems.sort((a, b) => a.price - b.price);
    
    // Load customizations and display
    loadProductCustomizations();
    displayItems();
    updateCartUI();
}

// Load menu data (synchronous, no async needed)
function loadMenuFromServer() {
    try {
        loadMenuData();
    } catch (error) {
        console.error('Error loading menu:', error);
        // Fallback: show error message
        const menuGrid = document.getElementById('menuGrid');
        const errorDiv = document.getElementById('menu-error');
        
        if (menuGrid) {
            menuGrid.innerHTML = `<div class="col-span-full text-center py-12">
                <div class="text-red-500 text-lg font-semibold mb-2">Menü yüklenemedi</div>
                <div class="text-gray-600 text-sm mb-4">${error.message || 'Lütfen sayfayı yenileyin'}</div>
                <button onclick="location.reload()" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">Sayfayı Yenile</button>
            </div>`;
        }
        
        if (errorDiv) {
            const msg = document.createElement('pre');
            msg.className = 'text-red-600 text-sm p-4 bg-red-50 rounded border border-red-200';
            msg.textContent = 'Menü verisi yüklenemedi.\n' + String(error);
            errorDiv.appendChild(msg);
        }
    }
}

// Load product customizations from localStorage (for backward compatibility, but menu is now server-side)
function loadProductCustomizations() {
    // Menu is now loaded from server, so this function is mainly for compatibility
    // No need to apply localStorage customizations as menu is managed server-side
}

let currentCategory = 'favoriler';
let searchQuery = '';
let cart = [];
let selectedTable = null;

// localStorage fonksiyonları
function saveCartToStorage() {
    localStorage.setItem('restaurantCart', JSON.stringify(cart));
}

function loadCartFromStorage() {
    const savedCart = localStorage.getItem('restaurantCart');
    if (savedCart) {
        cart = JSON.parse(savedCart);
    }
}

function saveSelectedTableToStorage() {
    if (selectedTable) {
        localStorage.setItem('restaurantSelectedTable', JSON.stringify(selectedTable));
    } else {
        localStorage.removeItem('restaurantSelectedTable');
    }
}

function loadSelectedTableFromStorage() {
    const savedTable = localStorage.getItem('restaurantSelectedTable');
    if (savedTable) {
        selectedTable = JSON.parse(savedTable);
    }
}

// Show success modal
function showSuccessModal(message, tableInfo) {
    // Remove existing modal if any
    const existingModal = document.getElementById('successModal');
    if (existingModal) {
        existingModal.remove();
    }
    
    // Create modal overlay
    const modal = document.createElement('div');
    modal.id = 'successModal';
    modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
    modal.onclick = function(e) {
        if (e.target === modal) {
            closeSuccessModal();
        }
    };
    
    const categoryNames = {
        'ust-kat': 'Üst Kat',
        'alt-kat': 'Alt Kat',
        'bahce': 'Bahçe'
    };
    const tableText = tableInfo ? `${categoryNames[tableInfo.category] || tableInfo.category} - Masa ${tableInfo.number}` : '';
    
    modal.innerHTML = `
        <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full p-8 text-center transform transition-all duration-300 scale-100">
            <div class="mb-6">
                <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-12 h-12 text-green-500">
                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                        <polyline points="22 4 12 14.01 9 11.01"></polyline>
                    </svg>
                </div>
                <h2 class="text-2xl font-bold text-gray-900 mb-2">${message}</h2>
                ${tableText ? `<p class="text-gray-600 text-lg font-semibold">${tableText}</p>` : ''}
            </div>
            <button onclick="closeSuccessModal()" class="w-full bg-green-500 text-white py-3 rounded-lg font-semibold hover:bg-green-600 transition-colors text-lg">
                Tamam
            </button>
        </div>
    `;
    
    document.body.appendChild(modal);
    
    // Auto close after 3 seconds
    setTimeout(() => {
        closeSuccessModal();
    }, 3000);
}

// Close success modal
function closeSuccessModal() {
    const modal = document.getElementById('successModal');
    if (modal) {
        const modalContent = modal.querySelector('div > div');
        if (modalContent) {
            modalContent.classList.remove('scale-100');
            modalContent.classList.add('scale-95');
        }
        modal.classList.add('opacity-0');
        setTimeout(() => {
            modal.remove();
        }, 300);
    }
}

// Make it globally accessible
window.closeSuccessModal = closeSuccessModal;

// Save order to localStorage
function saveOrder(cartItems, table, totalAmount) {
    // Get existing orders
    const orders = localStorage.getItem('restaurantOrders');
    const ordersList = orders ? JSON.parse(orders) : [];
    
    // Create new order
    const newOrder = {
        id: Date.now(), // Unique ID based on timestamp
        timestamp: new Date().toISOString(),
        table: {
            category: table.category,
            number: table.number
        },
        items: cartItems.map(item => ({
            id: item.id,
            name: item.name,
            price: item.price,
            quantity: item.quantity,
            image: item.image
        })),
        total: totalAmount,
        status: 'pending' // Bekleyen durumu
    };
    
    // Add to orders list
    ordersList.push(newOrder);
    
    // Save back to localStorage
    localStorage.setItem('restaurantOrders', JSON.stringify(ordersList));
}

// Category names - will be loaded from server with menu data
let categoryNames = {
    'favoriler': 'Favoriler',
    'sandvicler': 'Sandviçler',
    'kahvalti': 'Kahvaltı Tabakları',
    'yumurta': 'Yumurta Çeşitleri',
    'sicaklar': 'Sıcak Lezzetler',
    'icecekler': 'İçecekler'
};

// Kategori isimlerini çevir
function getCategoryName(category) {
    return categoryNames[category] || category;
}

// Map POS categories to menu item categories (no longer needed, using direct category mapping)
function mapCategoryToMenuCategories(posCategory) {
    // Direct category mapping - categories match menu item categories
    return [posCategory];
}

// Create Grid Card (for both mobile and desktop)
function createGridCard(item) {
    return `
        <div class="group bg-white rounded-lg shadow-md hover:shadow-lg transition-all duration-300 overflow-hidden border border-gray-200" data-product-id="${item.id}">
            <div class="relative overflow-hidden aspect-square cursor-pointer" onclick="showProductDetail(${item.id})">
                <img src="${item.image}" alt="${item.name}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-300">
            </div>
            <div class="p-2 sm:p-3">
                <h3 class="font-semibold text-gray-900 text-xs sm:text-sm mb-2 capitalize-words line-clamp-1 cursor-pointer" onclick="showProductDetail(${item.id})">${item.name}</h3>
                <div class="flex items-center justify-between gap-2">
                    <span class="text-sm sm:text-base font-bold text-green-600">${item.price.toFixed(2)}₺</span>
                    <button onclick="event.stopPropagation(); addToCart(${item.id})" class="flex-1 bg-green-500 text-white py-1.5 sm:py-2 rounded-lg hover:bg-green-600 transition-all duration-200 font-semibold text-xs sm:text-sm shadow-sm hover:shadow-md">
                        Sepete Ekle
                    </button>
                </div>
            </div>
        </div>
    `;
}

// Load product order from localStorage
function loadProductOrder() {
    const saved = localStorage.getItem('restaurantProductOrder');
    if (saved) {
        return JSON.parse(saved);
    }
    return {};
}

// Get sorted products for a category
function getSortedMenuItems(category) {
    // Get deleted products list
    const deletedProducts = JSON.parse(localStorage.getItem('restaurantDeletedProducts') || '[]');
    
    console.log('getSortedMenuItems called:', {
        category,
        totalMenuItems: menuItems.length,
        deletedProducts: deletedProducts.length,
        availableCategories: [...new Set(menuItems.map(i => i.category))]
    });
    
    // Filter products by category and exclude deleted ones
    const filteredItems = menuItems.filter(item => 
        item.category === category && !deletedProducts.includes(item.id)
    );
    
    console.log('Filtered items for category', category, ':', filteredItems.length);
    
    const order = loadProductOrder();
    const categoryOrder = order[category] || [];
    
    // If we have saved order for this category, use it
    if (categoryOrder.length > 0) {
        const orderedItems = [];
        const unorderedItems = [];
        
        // Add items in saved order
        categoryOrder.forEach(id => {
            const item = filteredItems.find(p => p.id === id);
            if (item) {
                orderedItems.push(item);
            }
        });
        
        // Add any items not in saved order (new items)
        filteredItems.forEach(item => {
            if (!categoryOrder.includes(item.id)) {
                unorderedItems.push(item);
            }
        });
        
        return [...orderedItems, ...unorderedItems];
    }
    
    // No saved order, return original order
    return filteredItems;
}

// Filter and Display Items
function displayItems() {
    const menuGrid = document.getElementById('menuGrid');
    
    // Check if menuGrid exists (only on index.html)
    if (!menuGrid) {
        return; // Silently return if not on index page
    }
    
    let filteredItems = [];
    
    // If searching, search across all categories
    if (searchQuery.trim() !== '') {
        filteredItems = menuItems.filter(item => {
            const matchesSearch = item.name.toLowerCase().includes(searchQuery.toLowerCase()) || 
                                 item.description.toLowerCase().includes(searchQuery.toLowerCase()) ||
                                 item.id.toString().includes(searchQuery);
            return matchesSearch;
        });
    } else {
        // Use sorted items for current category
        filteredItems = getSortedMenuItems(currentCategory);
    }

    console.log('DisplayItems called:', { 
        currentCategory, 
        searchQuery, 
        filteredItemsCount: filteredItems.length,
        totalItems: menuItems.length,
        menuItemsEmpty: menuItems.length === 0,
        sampleCategories: [...new Set(menuItems.map(i => i.category))]
    });

    if (menuItems.length === 0) {
        menuGrid.innerHTML = '<div class="col-span-full text-center py-12 text-red-500">Menü verileri yüklenemedi. Lütfen sayfayı yenileyin.</div>';
        return;
    }
    
    if (filteredItems.length === 0) {
        menuGrid.innerHTML = `<div class="col-span-full text-center py-12 text-gray-500">
            <p class="mb-2">Bu kategoride ürün bulunamadı.</p>
            <p class="text-sm text-gray-400">Kategori: ${currentCategory}, Toplam ürün: ${menuItems.length}</p>
        </div>`;
        return;
    }

    menuGrid.innerHTML = filteredItems.map(item => createGridCard(item)).join('');
    
    // Add click event listeners to product cards
    attachProductCardListeners();
}

// Filter Button Click Handler
// Search Input Handler
// Cart Button Event Listeners
// Tüm initialization kodları tek bir DOMContentLoaded içinde

// Add to Cart Function
function addToCart(itemId) {
    const item = menuItems.find(i => i.id === itemId);
    if (!item) return;
    
    const existingItem = cart.find(c => c.id === itemId);
    if (existingItem) {
        existingItem.quantity += 1;
    } else {
        cart.push({ ...item, quantity: 1 });
    }
    
    saveCartToStorage(); // localStorage'a kaydet
    updateCartUI();
    
    // Show success animation (if button exists)
    if (event && event.target) {
        const button = event.target;
        const originalText = button.textContent;
        button.textContent = '✓ Eklendi';
        // Buton zaten bg-green-500 ile başlıyor, sadece metni değiştiriyoruz
        setTimeout(() => {
            button.textContent = originalText;
            // bg-green-500'i kaldırmıyoruz, buton her zaman yeşil kalacak
        }, 1000);
    }
}

// Remove from Cart
function removeFromCart(itemId) {
    cart = cart.filter(item => item.id !== itemId);
    saveCartToStorage(); // localStorage'a kaydet
    updateCartUI();
}

// Update Quantity
function updateQuantity(itemId, change) {
    const item = cart.find(c => c.id === itemId);
    if (item) {
        item.quantity += change;
        if (item.quantity <= 0) {
            removeFromCart(itemId);
        } else {
            saveCartToStorage(); // localStorage'a kaydet
            updateCartUI();
        }
    }
}

// Update Cart UI
function updateCartUI() {
    // Update cart badges
    const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
    const mobileCartBadge = document.getElementById('mobileCartBadge');
    
    if (mobileCartBadge) {
        if (totalItems > 0) {
            mobileCartBadge.textContent = totalItems;
            mobileCartBadge.classList.remove('hidden');
        } else {
            mobileCartBadge.classList.add('hidden');
        }
    }
    
    // Update cart sidebar
    updateCartSidebar();
    
    // Update cart modal
    updateCartModal();
}

// Update Cart Sidebar
function updateCartSidebar() {
    const cartSidebarContent = document.getElementById('cartSidebarContent');
    const cartSidebarFooter = document.getElementById('cartSidebarFooter');
    const emptyCartSidebar = document.getElementById('emptyCartSidebar');
    const cartSidebar = document.getElementById('cartSidebar');
    
    if (!cartSidebarContent || !cartSidebarFooter || !emptyCartSidebar) {
        return;
    }
    
    if (cart.length === 0) {
        emptyCartSidebar.classList.remove('hidden');
        cartSidebarFooter.classList.add('hidden');
        // Clear cart items but keep empty cart message
        const itemsHTML = cartSidebarContent.querySelectorAll('div:not(#emptyCartSidebar)');
        itemsHTML.forEach(item => item.remove());
        return;
    }
    
    emptyCartSidebar.classList.add('hidden');
    cartSidebarFooter.classList.remove('hidden');
    
    // Masa numarası seçilmediyse butonu devre dışı bırak
    const checkoutBtn = document.getElementById('checkoutButtonSidebar');
    if (checkoutBtn) {
        if (!selectedTable) {
            checkoutBtn.disabled = true;
            const selectedTableDiv = document.getElementById('selectedTable');
            if (selectedTableDiv) {
                selectedTableDiv.classList.add('hidden');
            }
            const tableButtons = document.querySelectorAll('.table-btn');
            tableButtons.forEach(btn => {
                btn.classList.remove('bg-green-500', 'border-green-500', 'text-white');
                btn.classList.add('border-gray-300', 'text-gray-700');
            });
        } else {
            checkoutBtn.disabled = false;
            const selectedTableDiv = document.getElementById('selectedTable');
            const selectedTableText = document.getElementById('selectedTableText');
            if (selectedTableDiv && selectedTableText) {
                const categoryNames = {
                    'ust-kat': 'Üst Kat',
                    'alt-kat': 'Alt Kat',
                    'bahce': 'Bahçe'
                };
                selectedTableText.textContent = `${categoryNames[selectedTable.category]} - Masa ${selectedTable.number}`;
                selectedTableDiv.classList.remove('hidden');
            }
            const tableButtons = document.querySelectorAll('.table-btn');
            tableButtons.forEach(btn => {
                btn.classList.remove('bg-green-500', 'border-green-500', 'text-white');
                btn.classList.add('border-gray-300', 'text-gray-700');
            });
            const selectedButton = document.querySelector(`.table-btn[data-category="${selectedTable.category}"][data-table="${selectedTable.number}"]`);
            if (selectedButton) {
                selectedButton.classList.remove('border-gray-300', 'text-gray-700');
                selectedButton.classList.add('bg-green-500', 'border-green-500', 'text-white');
            }
        }
    }
    
    // Remove existing cart items (but not emptyCartSidebar)
    const existingItems = cartSidebarContent.querySelectorAll('div:not(#emptyCartSidebar)');
    existingItems.forEach(item => item.remove());
    
    let total = 0;
    const itemsHTML = cart.map(item => {
        const itemTotal = item.price * item.quantity;
        total += itemTotal;
        
        return `
            <div class="flex items-center space-x-2 sm:space-x-4 mb-4 pb-4 border-b border-gray-200 last:border-0">
                <img src="${item.image}" alt="${item.name}" class="w-12 h-12 sm:w-16 sm:h-16 rounded-lg object-cover shadow-md flex-shrink-0">
                <div class="flex-1 min-w-0">
                    <h3 class="font-semibold text-gray-900 text-xs sm:text-sm truncate">${item.name}</h3>
                    <p class="text-xs text-gray-500 mt-0.5">${item.price.toFixed(2)}₺ x ${item.quantity}</p>
                    <div class="mt-1">
                        <span class="text-sm font-bold text-green-600">${itemTotal.toFixed(2)}₺</span>
                    </div>
                </div>
                <div class="flex items-center space-x-1 sm:space-x-2 flex-shrink-0">
                    <div class="flex items-center space-x-1 bg-gray-100 rounded-lg">
                        <button onclick="updateQuantity(${item.id}, -1)" class="px-2 py-1 text-gray-600 hover:text-green-600 font-semibold text-xs sm:text-sm">-</button>
                        <span class="px-2 py-1 font-semibold text-gray-900 text-xs sm:text-sm">${item.quantity}</span>
                        <button onclick="updateQuantity(${item.id}, 1)" class="px-2 py-1 text-gray-600 hover:text-green-600 font-semibold text-xs sm:text-sm">+</button>
                    </div>
                    <button onclick="removeFromCart(${item.id})" class="text-red-500 hover:text-red-700 transition-colors flex-shrink-0 ml-1">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 sm:w-5 sm:h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M3 6h18"></path>
                            <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
                            <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
                        </svg>
                    </button>
                </div>
            </div>
        `;
    }).join('');
    
    cartSidebarContent.insertAdjacentHTML('beforeend', itemsHTML);
    
    const cartSidebarTotal = document.getElementById('cartSidebarTotal');
    if (cartSidebarTotal) {
        cartSidebarTotal.textContent = `₺${total.toFixed(2)}`;
    }
    
    // Show sidebar on desktop if cart has items
    if (cartSidebar && window.innerWidth >= 1024) {
        if (cart.length > 0) {
            cartSidebar.classList.remove('hidden');
            cartSidebar.classList.add('flex');
        }
    }
}

// Update Cart Modal
function updateCartModal() {
    const cartItems = document.getElementById('cartItems');
    const cartFooter = document.getElementById('cartFooter');
    const emptyCart = document.getElementById('emptyCart');
    
    // Check if cart modal elements exist (only on index.html)
    if (!cartItems || !cartFooter || !emptyCart) {
        return; // Silently return if not on index page
    }
    
    if (cart.length === 0) {
        emptyCart.classList.remove('hidden');
        cartFooter.classList.add('hidden');
        // Clear cart items but keep empty cart message
        const itemsHTML = cartItems.querySelectorAll('div:not(#emptyCart)');
        itemsHTML.forEach(item => item.remove());
        return;
    }
    
    emptyCart.classList.add('hidden');
    cartFooter.classList.remove('hidden');
    
    // Masa numarası seçilmediyse butonu devre dışı bırak
    const checkoutBtn = document.getElementById('checkoutButton');
    if (checkoutBtn) {
        if (!selectedTable) {
            checkoutBtn.disabled = true;
            // Seçilen masa bilgisini gizle
            const selectedTableDiv = document.getElementById('selectedTable');
            if (selectedTableDiv) {
                selectedTableDiv.classList.add('hidden');
            }
                // Tüm masa butonlarını sıfırla
            const tableButtons = document.querySelectorAll('.table-btn');
            tableButtons.forEach(btn => {
                btn.classList.remove('bg-green-500', 'border-green-500', 'text-white');
                btn.classList.add('border-gray-300', 'text-gray-700');
            });
        } else {
            checkoutBtn.disabled = false;
            // Seçilen masa bilgisini göster
            const selectedTableDiv = document.getElementById('selectedTable');
            const selectedTableText = document.getElementById('selectedTableText');
            if (selectedTableDiv && selectedTableText) {
                const categoryNames = {
                    'ust-kat': 'Üst Kat',
                    'alt-kat': 'Alt Kat',
                    'bahce': 'Bahçe'
                };
                selectedTableText.textContent = `${categoryNames[selectedTable.category]} - Masa ${selectedTable.number}`;
                selectedTableDiv.classList.remove('hidden');
            }
            // Seçili masayı butonlarda vurgula
            const tableButtons = document.querySelectorAll('.table-btn');
            tableButtons.forEach(btn => {
                btn.classList.remove('bg-green-500', 'border-green-500', 'text-white');
                btn.classList.add('border-gray-300', 'text-gray-700');
            });
            const selectedButton = document.querySelector(`.table-btn[data-category="${selectedTable.category}"][data-table="${selectedTable.number}"]`);
            if (selectedButton) {
                selectedButton.classList.remove('border-gray-300', 'text-gray-700');
                selectedButton.classList.add('bg-green-500', 'border-green-500', 'text-white');
            }
        }
    }
    
    // Remove empty cart message if it exists as a direct child
    if (cartItems.contains(emptyCart)) {
        // emptyCart is already in the DOM, just hide it
    }
    
    // Remove existing cart items (but not emptyCart)
    const existingItems = cartItems.querySelectorAll('div:not(#emptyCart)');
    existingItems.forEach(item => item.remove());
    
    let total = 0;
    const itemsHTML = cart.map(item => {
        const itemTotal = item.price * item.quantity;
        total += itemTotal;
        
        return `
            <div class="flex items-center space-x-2 sm:space-x-4 mb-4 pb-4 border-b border-gray-200 last:border-0">
                <img src="${item.image}" alt="${item.name}" class="w-16 h-16 sm:w-20 sm:h-20 rounded-xl object-cover shadow-md flex-shrink-0">
                <div class="flex-1 min-w-0">
                    <h3 class="font-bold text-gray-900 text-xs sm:text-base truncate">${item.name}</h3>
                    <p class="text-xs text-gray-500 mt-0.5">${item.price.toFixed(2)}₺ x ${item.quantity}</p>
                    <div class="mt-1 sm:hidden">
                        <span class="text-sm font-bold text-green-600">${itemTotal.toFixed(2)}₺</span>
                    </div>
                </div>
                <div class="flex items-center space-x-1 sm:space-x-3 flex-shrink-0">
                    <div class="flex items-center space-x-1 bg-gray-100 rounded-lg">
                        <button onclick="updateQuantity(${item.id}, -1)" class="px-1.5 sm:px-3 py-1 text-gray-600 hover:text-green-600 font-semibold text-xs sm:text-base">-</button>
                        <span class="px-1.5 sm:px-3 py-1 font-semibold text-gray-900 text-xs sm:text-base">${item.quantity}</span>
                        <button onclick="updateQuantity(${item.id}, 1)" class="px-1.5 sm:px-3 py-1 text-gray-600 hover:text-green-600 font-semibold text-xs sm:text-base">+</button>
                    </div>
                    <span class="text-sm sm:text-lg font-bold text-green-600 hidden sm:inline-block sm:w-20 sm:text-right">${itemTotal.toFixed(2)}₺</span>
                    <button onclick="removeFromCart(${item.id})" class="text-red-500 hover:text-red-700 transition-colors flex-shrink-0">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 sm:w-5 sm:h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M3 6h18"></path>
                            <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
                            <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
                        </svg>
                    </button>
                </div>
            </div>
        `;
    }).join('');
    
    cartItems.insertAdjacentHTML('beforeend', itemsHTML);
    
    const cartTotalElement = document.getElementById('cartTotal');
    if (cartTotalElement) {
        cartTotalElement.textContent = `₺${total.toFixed(2)}`;
    }
}

// Open Cart Modal
function openCartModal() {
    const cartModal = document.getElementById('cartModal');
    if (cartModal) {
        cartModal.classList.remove('hidden');
        cartModal.classList.add('flex');
        document.body.style.overflow = 'hidden';
        // Sepet içeriğini güncelle
        updateCartModal();
    }
}

// Handle cart button click
function handleCartButtonClick(e) {
    if (e) {
        e.preventDefault();
        e.stopPropagation();
    }
    
    console.log('Cart button clicked, window width:', window.innerWidth);
    
    // Mobilde modal aç, desktop'ta sidebar göster
    if (window.innerWidth < 1024) {
        console.log('Opening cart modal (mobile)');
        openCartModal();
    } else {
        // Desktop'ta sidebar'ı göster
        const cartSidebar = document.getElementById('cartSidebar');
        console.log('Opening cart sidebar (desktop), cartSidebar exists:', !!cartSidebar);
        if (cartSidebar) {
            cartSidebar.classList.remove('hidden');
            cartSidebar.classList.add('flex');
            // Sepet içeriğini güncelle
            updateCartSidebar();
        }
    }
}

// Make it globally accessible
window.handleCartButtonClick = handleCartButtonClick;
window.openCartModal = openCartModal;

// Close Cart Modal
function closeCartModal() {
    const cartModal = document.getElementById('cartModal');
    if (cartModal) {
        cartModal.classList.add('hidden');
        cartModal.classList.remove('flex');
        document.body.style.overflow = 'auto';
    }
}

// Close Cart Sidebar
function closeCartSidebar() {
    const cartSidebar = document.getElementById('cartSidebar');
    const menuSection = document.getElementById('menuSection');
    if (cartSidebar) {
        cartSidebar.classList.add('hidden');
        cartSidebar.classList.remove('flex');
    }
    if (menuSection) {
        menuSection.classList.remove('hidden');
    }
}

// Make functions globally accessible
window.closeCartModal = closeCartModal;
window.closeCartSidebar = closeCartSidebar;

// Open Product Detail Modal
function openProductModal(itemId) {
    const item = menuItems.find(i => i.id === itemId);
    if (!item) return;
    
    document.getElementById('productModalImage').src = item.image;
    document.getElementById('productModalImage').alt = item.name;
    document.getElementById('productModalName').textContent = item.name;
    document.getElementById('productModalDescription').textContent = item.description;
    document.getElementById('productModalPrice').textContent = `${item.price.toFixed(2)}₺`;
    document.getElementById('productModalCategory').textContent = getCategoryName(item.category);
    
    // Set the add to cart button
    const addToCartBtn = document.getElementById('addToCartFromModal');
    addToCartBtn.onclick = () => {
        addToCart(itemId);
        closeProductModal();
    };
    
    const productModal = document.getElementById('productModal');
    productModal.classList.remove('hidden');
    productModal.classList.add('flex');
    document.body.style.overflow = 'hidden';
}

// Close Product Detail Modal
function closeProductModal() {
    const productModal = document.getElementById('productModal');
    if (productModal) {
        productModal.classList.add('hidden');
        productModal.classList.remove('flex');
        document.body.style.overflow = 'auto';
    }
}

// Make it globally accessible
window.closeProductModal = closeProductModal;

// Show Product Detail (wrapper for openProductModal)
function showProductDetail(itemId) {
    const item = menuItems.find(i => i.id === itemId);
    if (!item) {
        console.error('Product not found with ID:', itemId);
        return;
    }
    openProductModal(itemId);
}

// Make it globally accessible
window.showProductDetail = showProductDetail;

// Attach click listeners to product cards
function attachProductCardListeners() {
    const productCards = document.querySelectorAll('.product-card');
    productCards.forEach(card => {
        card.addEventListener('click', (e) => {
            // Don't open modal if clicking on the add to cart button
            if (e.target.closest('.add-to-cart-btn')) {
                return;
            }
            const itemId = parseInt(card.dataset.itemId);
            openProductModal(itemId);
        });
    });
}

// Initialize deleted products (permanently remove specific products)
function initializeDeletedProducts() {
    const deletedProducts = JSON.parse(localStorage.getItem('restaurantDeletedProducts') || '[]');
    
    // Permanently remove PESTO - FÜME (ID: 1) and EGE SERPMESİ (ID: 2)
    const productsToRemove = [1, 2];
    
    productsToRemove.forEach(productId => {
        if (!deletedProducts.includes(productId)) {
            deletedProducts.push(productId);
        }
    });
    
    // Ensure these products are NOT deleted (ID: 81 and 218)
    const productsToKeep = [81, 218];
    productsToKeep.forEach(productId => {
        const index = deletedProducts.indexOf(productId);
        if (index > -1) {
            deletedProducts.splice(index, 1);
        }
    });
    
    localStorage.setItem('restaurantDeletedProducts', JSON.stringify(deletedProducts));
}


// Tüm initialization kodları tek bir DOMContentLoaded içinde
document.addEventListener('DOMContentLoaded', () => {
    console.log('DOMContentLoaded');
    
    // Initialize deleted products first
    initializeDeletedProducts();
    
    // Load menu data (embedded, no backend needed)
    try {
        loadMenuFromServer();
        console.log('Initial display tamamlandı');
    } catch (err) {
        console.error('Error loading menu:', err);
        const errorDiv = document.getElementById('menu-error');
        if (errorDiv) {
            const msg = document.createElement('pre');
            msg.className = 'text-red-600 text-sm p-4 bg-red-50 rounded border border-red-200';
            msg.textContent = 'Menü verisi yüklenemedi.\n' + String(err);
            errorDiv.appendChild(msg);
        }
    }
    
    // Category Button Click Handler
    document.querySelectorAll('.category-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            document.querySelectorAll('.category-btn').forEach(b => {
                b.classList.remove('active', 'bg-green-500', 'text-white');
                b.classList.add('bg-gray-200', 'text-gray-700');
            });
            
            btn.classList.add('active', 'bg-green-500', 'text-white');
            btn.classList.remove('bg-gray-200', 'text-gray-700');
            
            currentCategory = btn.dataset.category;
            displayItems();
        });
    });
    
    // Filter Button Click Handler - Desktop (for backward compatibility)
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            document.querySelectorAll('.filter-btn').forEach(b => {
                b.classList.remove('active', 'bg-gradient-to-r', 'from-green-500', 'to-green-600', 'text-white', 'shadow-lg', 'scale-105');
                b.classList.add('text-gray-600');
            });
            
            btn.classList.add('active', 'bg-gradient-to-r', 'from-green-500', 'to-green-600', 'text-white', 'shadow-lg', 'transform', 'scale-105');
            btn.classList.remove('text-gray-600');
            
            currentCategory = btn.dataset.category;
            displayItems();
        });
    });
    
    // Filter Button Click Handler - Mobile (for backward compatibility)
    document.querySelectorAll('.filter-btn-mobile').forEach(btn => {
        btn.addEventListener('click', () => {
            document.querySelectorAll('.filter-btn-mobile').forEach(b => {
                b.classList.remove('active', 'bg-gradient-to-r', 'from-green-500', 'to-green-600', 'text-white');
                b.classList.add('text-gray-600');
            });
            
            btn.classList.add('active', 'bg-gradient-to-r', 'from-green-500', 'to-green-600', 'text-white');
            btn.classList.remove('text-gray-600');
            
            currentCategory = btn.dataset.category;
            displayItems();
        });
    });
    
    // Search Input Handler
    const searchInput = document.getElementById('searchInput');
    const searchInputMobile = document.getElementById('searchInputMobile');
    
    if (searchInput) {
        searchInput.addEventListener('input', (e) => {
            searchQuery = e.target.value;
            displayItems();
        });
    }
    
    if (searchInputMobile) {
        searchInputMobile.addEventListener('input', (e) => {
            searchQuery = e.target.value;
            displayItems();
        });
    }
    
    // Cart Sidebar - Show/hide on mobile
    const cartSidebar = document.getElementById('cartSidebar');
    const closeCartSidebar = document.getElementById('closeCartSidebar');
    const mobileCartButton = document.getElementById('mobileCartButton');
    
    if (closeCartSidebar) {
        // Event listener ekle (onclick ile birlikte çalışır)
        closeCartSidebar.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            closeCartSidebar();
        });
    }
    
    // Cart button - open cart modal (mobile) or show sidebar (desktop)
    const menuSection = document.getElementById('menuSection');
    if (mobileCartButton) {
        // Event listener ekle (onclick ile birlikte çalışır)
        mobileCartButton.addEventListener('click', handleCartButtonClick);
        
        // Ayrıca mousedown event'i de ekle
        mobileCartButton.addEventListener('mousedown', (e) => {
            e.preventDefault();
        });
    }
    
    // Show cart sidebar on mobile when items are added
    // On desktop, sidebar is always visible when cart has items
    
    // Cart Button Event Listeners
    const cartButtonDesktop = document.getElementById('cartButtonDesktop');
    const cartButtonMobile = document.getElementById('cartButtonMobile');
    const closeCartModalBtn = document.getElementById('closeCartModal');
    const checkoutButton = document.getElementById('checkoutButton');
    const cartModal = document.getElementById('cartModal');
    
    if (cartButtonDesktop) {
        cartButtonDesktop.addEventListener('click', openCartModal);
    }
    
    if (cartButtonMobile) {
        cartButtonMobile.addEventListener('click', openCartModal);
    }
    
    if (closeCartModalBtn) {
        // Event listener ekle (onclick ile birlikte çalışır)
        closeCartModalBtn.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            closeCartModal();
        });
    }
    
    if (checkoutButton) {
        checkoutButton.addEventListener('click', () => {
            if (cart.length > 0) {
                if (!selectedTable) {
                    alert('Lütfen masa numarası seçiniz!');
                    return;
                }
                const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                const categoryNames = {
                    'ust-kat': 'Üst Kat',
                    'alt-kat': 'Alt Kat',
                    'bahce': 'Bahçe'
                };
                const categoryName = categoryNames[selectedTable.category] || selectedTable.category;
                
                // Save order to localStorage
                saveOrder(cart, selectedTable, total);
                
                // Show success modal with table info
                showSuccessModal('Sipariş Alındı!', selectedTable);
                
                // Update sidebar
                updateCartSidebar();
                cart = [];
                selectedTable = null;
                localStorage.removeItem('restaurantCart'); // localStorage'ı temizle
                localStorage.removeItem('restaurantSelectedTable'); // Seçili masayı temizle
                updateCartUI();
                closeCartModal();
            }
        });
    }
    
    // Sidebar checkout button
    const checkoutButtonSidebar = document.getElementById('checkoutButtonSidebar');
    if (checkoutButtonSidebar) {
        checkoutButtonSidebar.addEventListener('click', () => {
            if (cart.length > 0) {
                if (!selectedTable) {
                    alert('Lütfen masa numarası seçiniz!');
                    return;
                }
                const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                const categoryNames = {
                    'ust-kat': 'Üst Kat',
                    'alt-kat': 'Alt Kat',
                    'bahce': 'Bahçe'
                };
                const categoryName = categoryNames[selectedTable.category] || selectedTable.category;
                
                // Save order to localStorage
                saveOrder(cart, selectedTable, total);
                
                // Show success modal with table info
                showSuccessModal('Sipariş Alındı!', selectedTable);
                
                // Update sidebar
                updateCartSidebar();
                cart = [];
                selectedTable = null;
                localStorage.removeItem('restaurantCart'); // localStorage'ı temizle
                localStorage.removeItem('restaurantSelectedTable'); // Seçili masayı temizle
                updateCartUI();
                closeCartSidebar();
            }
        });
    }
    
    // Accordion açma/kapama işlevselliği (hem modal hem sidebar için)
    const cartFooter = document.getElementById('cartFooter');
    const cartSidebarFooter = document.getElementById('cartSidebarFooter');
    
    function setupAccordion(container) {
        if (!container) return;
        
        container.addEventListener('click', (e) => {
            if (e.target.classList.contains('accordion-header') || e.target.closest('.accordion-header')) {
                const header = e.target.classList.contains('accordion-header') ? e.target : e.target.closest('.accordion-header');
                const content = header.nextElementSibling;
                const icon = header.querySelector('.accordion-icon');
                
                // Mevcut accordion'u aç/kapa
                if (content.classList.contains('hidden')) {
                    content.classList.remove('hidden');
                    icon.classList.add('rotate-180');
                } else {
                    content.classList.add('hidden');
                    icon.classList.remove('rotate-180');
                }
            }
            
            // Masa butonlarına tıklama
            if (e.target.classList.contains('table-btn') || e.target.closest('.table-btn')) {
                const btn = e.target.classList.contains('table-btn') ? e.target : e.target.closest('.table-btn');
                
                // Tüm butonlardan seçili durumu kaldır
                const allTableButtons = document.querySelectorAll('.table-btn');
                allTableButtons.forEach(b => {
                    b.classList.remove('bg-green-500', 'border-green-500', 'text-white');
                    b.classList.add('border-gray-300', 'text-gray-700');
                });
                
                // Seçilen butonu vurgula
                btn.classList.remove('border-gray-300', 'text-gray-700');
                btn.classList.add('bg-green-500', 'border-green-500', 'text-white');
                
                // Seçilen masayı kaydet
                selectedTable = {
                    category: btn.dataset.category,
                    number: btn.dataset.table
                };
                
                saveSelectedTableToStorage();
                
                // Seçilen masa bilgisini göster
                const selectedTableDivs = document.querySelectorAll('#selectedTable');
                const selectedTableTexts = document.querySelectorAll('#selectedTableText');
                const categoryNames = {
                    'ust-kat': 'Üst Kat',
                    'alt-kat': 'Alt Kat',
                    'bahce': 'Bahçe'
                };
                selectedTableTexts.forEach(text => {
                    text.textContent = `${categoryNames[selectedTable.category]} - Masa ${selectedTable.number}`;
                });
                selectedTableDivs.forEach(div => {
                    div.classList.remove('hidden');
                });
                
                // Checkout butonlarını aktif et
                const checkoutButtons = document.querySelectorAll('#checkoutButton, #checkoutButtonSidebar');
                checkoutButtons.forEach(button => {
                    if (button) button.disabled = false;
                });
                
                // Update UI
                updateCartUI();
            }
        });
    }
    
    if (cartFooter) {
        setupAccordion(cartFooter);
    }
    
    if (cartSidebarFooter) {
        setupAccordion(cartSidebarFooter);
    }
    
    // Close modal when clicking outside
    if (cartModal) {
        cartModal.addEventListener('click', (e) => {
            if (e.target === cartModal) {
                closeCartModal();
            }
        });
    }
    
    // Product Modal Event Listeners
    const productModal = document.getElementById('productModal');
    const closeProductModalBtn = document.getElementById('closeProductModal');
    
    if (closeProductModalBtn) {
        // Multiple event listeners to ensure it works
        closeProductModalBtn.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            closeProductModal();
        });
        
        closeProductModalBtn.addEventListener('mousedown', (e) => {
            e.preventDefault();
            e.stopPropagation();
        });
        
        // Direct onclick handler as backup
        closeProductModalBtn.onclick = function(e) {
            e.preventDefault();
            e.stopPropagation();
            closeProductModal();
            return false;
        };
    }
    
    if (productModal) {
        // Prevent modal from closing when clicking inside content
        const modalContent = productModal.querySelector('div > div');
        if (modalContent) {
            modalContent.addEventListener('click', (e) => {
                e.stopPropagation();
            });
        }
    }
    
    // ESC tuşu ile modal'ı kapat
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
            if (productModal && !productModal.classList.contains('hidden')) {
                closeProductModal();
            }
            if (cartModal && !cartModal.classList.contains('hidden')) {
                closeCartModal();
            }
        }
    });
    
    // Initial Display - Sayfa yüklendiğinde ürünleri göster
    // localStorage'dan sepeti ve seçili masayı yükle
    loadCartFromStorage();
    loadSelectedTableFromStorage();
    
    // Favoriler sayfasını aktif et (siteye girince favoriler çıksın)
    currentCategory = 'favoriler';
    searchQuery = ''; // Arama sorgusunu temizle
    const favorilerBtn = document.querySelector('.category-btn[data-category="favoriler"]');
    if (favorilerBtn) {
        // Tüm butonları sıfırla
        document.querySelectorAll('.category-btn').forEach(b => {
            b.classList.remove('active', 'bg-green-500', 'text-white');
            b.classList.add('bg-gray-200', 'text-gray-700');
        });
        // Favoriler butonunu aktif et
        favorilerBtn.classList.add('active', 'bg-green-500', 'text-white');
        favorilerBtn.classList.remove('bg-gray-200', 'text-gray-700');
    }
    
    // Hemen favoriler ürünlerini göster
    if (document.getElementById('menuGrid')) {
        displayItems();
    }
    
    // Seçili masa varsa UI'da göster ve accordion'u açık tut
    if (selectedTable) {
        const selectedTableDiv = document.getElementById('selectedTable');
        const selectedTableText = document.getElementById('selectedTableText');
        const categoryNames = {
            'ust-kat': 'Üst Kat',
            'alt-kat': 'Alt Kat',
            'bahce': 'Bahçe'
        };
        if (selectedTableDiv && selectedTableText) {
            selectedTableText.textContent = `${categoryNames[selectedTable.category]} - Masa ${selectedTable.number}`;
            selectedTableDiv.classList.remove('hidden');
        }
        
        // Accordion'u açık tut
        const accordionHeader = document.querySelector('.accordion-header[data-accordion="masalar"]');
        const accordionContent = accordionHeader?.nextElementSibling;
        const accordionIcon = accordionHeader?.querySelector('.accordion-icon');
        if (accordionHeader && accordionContent && accordionIcon) {
            accordionContent.classList.remove('hidden');
            accordionIcon.classList.add('rotate-180');
        }
        
        // Seçili masayı butonlarda vurgula
        const tableButton = document.querySelector(`.table-btn[data-category="${selectedTable.category}"][data-table="${selectedTable.number}"]`);
        if (tableButton) {
            tableButton.classList.remove('border-gray-300', 'text-gray-700');
            tableButton.classList.add('bg-green-500', 'border-green-500', 'text-white');
        }
    }
    
    console.log('DOMContentLoaded tamamlandı');
    console.log('Menu items sayısı:', menuItems.length);
    console.log('Current category:', currentCategory);
    
    // updateCartUI'yi çağır (displayItems zaten yukarıda çağrıldı)
    updateCartUI();
    console.log('Initial display tamamlandı');
});

